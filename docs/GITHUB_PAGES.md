# Deploying Venture to GitHub Pages

This guide explains how to deploy Venture as a WebAssembly application to GitHub Pages.

## Overview

The Venture client can be compiled to WebAssembly and deployed to GitHub Pages for browser-based gameplay. The deployment process is fully automated via GitHub Actions.

## File Structure

The WebAssembly deployment uses the following structure:

```
build/wasm/
├── .gitignore          # Ignores generated files (venture.wasm, wasm_exec.js)
├── README.md           # WASM build documentation
├── index.html          # Landing page with game info (version controlled)
├── game.html           # Game container HTML (version controlled)
├── venture.wasm        # Compiled game binary (generated by CI/CD)
└── wasm_exec.js        # Go WASM runtime (generated by CI/CD)
```

Static HTML files (`index.html`, `game.html`) are version controlled in the repository, while generated files (`venture.wasm`, `wasm_exec.js`) are built during CI/CD and ignored by git.

## Prerequisites

- Repository with GitHub Actions enabled
- GitHub Pages enabled for the repository
- Go 1.24.5 or later

## Automatic Deployment

The repository includes a GitHub Actions workflow (`.github/workflows/pages.yml`) that automatically:

1. Compiles the client to WebAssembly (`build/wasm/venture.wasm`)
2. Copies the Go WASM runtime (`wasm_exec.js`) from the Go installation
3. Deploys all files from `build/wasm/` to GitHub Pages

### Triggering Deployment

The workflow runs automatically on:
- Every push to the `main` branch
- Manual trigger via GitHub Actions UI (workflow_dispatch)

To manually trigger:
1. Go to Actions tab in GitHub
2. Select "Deploy to GitHub Pages" workflow
3. Click "Run workflow"

## Setting Up GitHub Pages

1. Go to your repository Settings
2. Navigate to Pages section (under Code and automation)
3. Under "Build and deployment":
   - Source: Select "GitHub Actions"
4. Save the settings

The site will be available at: `https://<username>.github.io/<repository>/`

For example: `https://opd-ai.github.io/venture/`

## Local Testing

Before pushing, test the WebAssembly build locally:

```bash
# Build the WASM version
make build-wasm

# Start a local server and open in browser
make serve-wasm
```

Then open http://localhost:8080 in your browser.

### Manual Build Steps

If you prefer to build manually:

```bash
# Compile to WebAssembly
GOOS=js GOARCH=wasm go build -ldflags="-s -w" -o build/wasm/venture.wasm ./cmd/client

# Copy WASM runtime
cp $(go env GOROOT)/lib/wasm/wasm_exec.js build/wasm/

# Serve locally
cd build/wasm
python3 -m http.server 8080
```

## Workflow Details

The GitHub Actions workflow (`.github/workflows/pages.yml`) performs the following steps:

1. **Checkout**: Checks out the repository code
2. **Setup Go**: Installs Go 1.24.5
3. **Build WebAssembly binary**: Compiles the client with GOOS=js GOARCH=wasm
4. **Copy wasm_exec.js runtime**: Copies the Go WASM runtime from the Go installation
5. **Setup Pages**: Configures GitHub Pages deployment
6. **Upload artifact**: Uploads the `build/wasm/` directory
7. **Deploy to GitHub Pages**: Deploys the artifact to GitHub Pages

## Browser Compatibility

The WebAssembly build requires:
- WebAssembly support (all modern browsers since 2017)
- WebGL for rendering
- Web Audio API for sound

Tested browsers:
- Chrome/Edge 90+
- Firefox 88+
- Safari 14+

## Performance Considerations

- The WASM binary is approximately 10-15 MB due to the full game engine
- Uses `-s -w` linker flags to strip debug info and reduce size
- First load may take a few seconds to download and compile
- Subsequent loads use browser caching for faster startup

## Customizing the Deployment

### Modifying HTML Files

To customize the appearance or functionality:

1. Edit `build/wasm/index.html` (landing page) or `build/wasm/game.html` (game container)
2. Commit the changes
3. Push to trigger automatic redeployment

### Changing Build Flags

To modify the WebAssembly build:

1. Edit `.github/workflows/pages.yml`
2. Update the `go build` command in the "Build WebAssembly binary" step
3. Commit and push

Example: Add tags for different build configurations:
```yaml
- name: Build WebAssembly binary
  run: |
    GOOS=js GOARCH=wasm go build -tags wasm -ldflags="-s -w" -o build/wasm/venture.wasm ./cmd/client
```

## Troubleshooting

### Deployment Fails

1. Check GitHub Actions logs for errors
2. Verify Go version compatibility (1.24.5+)
3. Ensure GitHub Pages is enabled in repository settings

### WASM Binary Not Loading

1. Check browser console for errors
2. Verify MIME types are correct (GitHub Pages should handle this automatically)
3. Test locally with `make serve-wasm` to rule out build issues

### Audio Not Playing

Some browsers require user interaction before playing audio. The `game.html` includes `allow="autoplay"` in the iframe to address this, but users may still need to click on the page first.

## Security Considerations

- The WASM binary has the same security restrictions as JavaScript in the browser
- No server-side processing occurs on GitHub Pages (static hosting only)
- For multiplayer functionality, users need to connect to a separate game server

## Further Reading

- [Ebiten WebAssembly Documentation](https://ebitengine.org/en/documents/webassembly.html)
- [GitHub Pages Documentation](https://docs.github.com/en/pages)
- [WebAssembly Overview](https://webassembly.org/)
- `build/wasm/README.md` - WASM build documentation
- `docs/CI_CD.md` - CI/CD pipeline documentation
